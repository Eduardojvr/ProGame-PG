<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>ProGame</title>

<link
	href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200"
	rel="stylesheet" />
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
<link href="../resources/css/bootstrap.min.css" rel="stylesheet" />
<link href="../resources/css/light-bootstrap-dashboard.css?v=2.0.0 "
	rel="stylesheet" />
<link href="../resources/css/demo.css" rel="stylesheet" />
<link href="../resources/css/conteudo.css" rel="stylesheet" />
<link
	href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
	rel="stylesheet" id="bootstrap-css">
<script
	src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
</head>
<body>

	<div
	style="padding-left: 15%; padding-right: 60px; background-color: rgba(0, 0, 0, 0.6);"
	id="contrib" class="modal fade top" tabindex="-1" role="dialog"
	 aria-hidden="true" data-backdrop='true'
	>
	<div class="modal-dialog modal-lg modal-frame modal-top"
	  role="document">
	  <div style="background-color: rgba(255, 255, 255, 0.9);"
		class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"
			aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		<div class="modal-body">
		  <div style="text-align: center;">
			<h3>Obrigado!</h3>
		  </div>
		  <div class="row">
			<div class="col-3">
			  <img height="250" width="210" src="../resources/img/orcDancando.gif" alt="">
			</div>
			<div style="padding-left: 90px; padding-top: 5%;" class="col-8">
			  <h4>Com seu feedback, podemos aprimorar constantemente nossos serviços!</h4>
			</div>
		  </div>
		</div>
	  </div>
	</div>
  </div>

  <div
  style="padding-left: 15%; padding-right: 60px; background-color: rgba(0, 0, 0, 0.6);"
  id="alert" class="modal fade top" tabindex="-1" role="dialog"
   aria-hidden="true" data-backdrop='true'
  >
  <div class="modal-dialog modal-lg modal-frame modal-top"
	role="document">
	<div style="background-color: rgba(255, 255, 255, 0.9);"
	  class="modal-content">
	  <div class="modal-header">
		  <button type="button" class="close" data-dismiss="modal"
		  aria-label="Close">
		  <span aria-hidden="true">&times;</span>
		</button>
	  </div>
	  <div class="modal-body">
		<div style="text-align: center;">
		  <h3>Contribuição já realizada!</h3>
		</div>
		<div class="row">
		  <div class="col-3">
			<img height="250" width="210" src="../resources/img/orcDancando2.gif" alt="">
		  </div>
		  <div style="padding-left: 90px; padding-top: 5%;" class="col-8">
			<h4>Você já deu seu feedback neste material!</h4>
		  </div>
		</div>
	  </div>
	</div>
  </div>
</div>

  
	<div class="wrapper">
		<div id="menu"></div>
		<div class="main-panel">
			<div id="material" class="container">
				<span style="text-align: center;">
					<h2>{{ assunto }}</h2>
					<br>
				<br>
				</span>
				<div class="clearfix"></div>
				<div class="row video">
					<div class="col-md-20">
						<div class="media" v-for="material in listaMaterial">
							<iframe width="250" height="138"
								v-bind:src="material.urlMaterial" allowfullscreen="true"
								webkitallowfullscreen="true" mozallowfullscreen="true">
							</iframe>
							<div class="media-body pl-3">
								<div class="price">{{ material.tituloMaterial }}</div>
								<div class="stats">
									<span>Gostaram: {{ material.total }}</span><br> <span>Não gostaram: {{ material.totalDislike }}</span><br>
									<span> <img @click="likeVideo(material, 'l')" src="../resources/img/like.jpg"
										style="width: 30px; height: 30px;" alt="">
									</span>&nbsp; &nbsp; <span> <img @click="likeVideo(material, 'd')"
										src="../resources/img/deslike.jpg"
										style="width: 30px; height: 30px;" alt="">
									</span>
								</div>
							</div>

						</div>

					</div>
				</div>


				<!--                         
                        <div class="video"  v-for="material in listaMaterial">
                                <h4>{{ material.tituloMaterial }}</h4>
                                <iframe width="250" height="138" v-bind:src="material.urlMaterial" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true">
                                </iframe>
                        <br>
                        <br>

                        </div> -->


			</div>


		</div>
	</div>
	<script src="../resources/js/axios.min.js"></script>
	<script src="../resources/js/vue.js"></script>

	<script src="../resources/js/core/jquery.3.2.1.min.js"
		type="text/javascript"></script>
	<script src="../resources/js/core/popper.min.js" type="text/javascript"></script>
	<script src="../resources/js/core/bootstrap.min.js"
		type="text/javascript"></script>
	<script src="../resources/js/plugins/bootstrap-switch.js"></script>

	<script src="../resources/js/plugins/bootstrap-notify.js"></script>
	<script src="../resources/js/light-bootstrap-dashboard.js?v=2.0.0 "
		type="text/javascript"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.8/jquery.slimscroll.min.js"></script>

	<script src="../resources/js/Chart.js"></script>
	<script src="../resources/js/Chart.bundle.js"></script>
	<script src="../resources/js/Chart.bundle.min.js"></script>
	<script src="../resources/js/Chart.min.js"></script>


	<script>

$(function(){
    $('.listing-block').slimScroll({
		height: '500px'
	});
});

$(function(){
    $("#menu").load("base.html"); 
});


    let mat = new Vue({
    el : '#material',
    data : {
        listaMaterial: [],
		assunto: '',
		todosLikes: [],
		todosDislikes: [],
		matricula: ''
    },
    created : function(){
        const vm = this;
		vm.getMaterial();
		vm.getUser();
	},
	methods:{
		getUser : function(){
			const vm = this;
			axios.get('../rs/user/getUser').then(function(response){
				vm.matricula = response.data["matricula"];
			});
		},
		getAllLike : function(){
			const vm = this;
			axios.get('../rs/material/todosLikes/').then(function(response){
				vm.todosLikes = response.data;
					for(var i=0; i < vm.listaMaterial.length; i++){					
						for(var j = 0; j < vm.todosLikes.length; j++){
							if(vm.listaMaterial[i].idMaterial == vm.todosLikes[j].idMaterial){
								vm.listaMaterial[i].total = vm.todosLikes[j].total;
							}
						}
					}	
				});
			
				axios.get('../rs/material/todosDislikes/').then(function(response){
					vm.todosDislikes = response.data;
					for(var i=0; i < vm.listaMaterial.length; i++){					
						for(var j = 0; j < vm.todosDislikes.length; j++){
							if(vm.listaMaterial[i].idMaterial == vm.todosDislikes[j].idMaterial){
								vm.listaMaterial[i].totalDislike = vm.todosDislikes[j].total;
							}
						}
					}	
				});
			},
		getMaterial : function(){
			const vm = this;
			var count = 0;
			axios.get('../rs/material/getmaterial/'+sessionStorage.getItem('tipomidia')+'/'+
                  sessionStorage.getItem('idConteudo')+'/'+1).then(function(response) {
            vm.listaMaterial = response.data;
            vm.assunto = response.data[0].assunto;
            while(vm.listaMaterial[count]){
                vm.listaMaterial[count].urlMaterial = vm.listaMaterial[count].urlMaterial.replace("watch?v=", "embed/");
                count+=1;
			}
			vm.getAllLike();
        });
		},
		likeVideo : function(material, tipo){
			const vm = this;
			axios.get('../rs/material/likeVideo/'+material.idMaterial+'/'+vm.matricula+'/'+tipo).then(function(response){
				if(response.data == true){
					$("#contrib").modal("show");
					vm.getMaterial();
				} else {
					$("#alert").modal("show");
				}
			});
		}
	}
 });
    
</script>

</body>
</html>